--liquibase formatted sql

--changeset javal3:2

drop table params;
drop table list_type;
drop table objects;
drop table OBJECT_TYPE_ATTRIBUTES;
drop table attributes;
drop table object_types;

--TABLE OBJECTS


CREATE TABLE OBJECTS(
  OBJECT_ID number(38) NOT NULL,
  OBJECT_TYPE_ID number(38),
  PARENT_ID number(38)
);
ALTER TABLE OBJECTS ADD CONSTRAINT Key1 PRIMARY KEY (OBJECT_ID);

--TABLE OBJECT_TYPES

CREATE TABLE OBJECT_TYPES(
  OBJECT_TYPE_ID number(38) NOT NULL,
  NAME Varchar2(40) NOT NULL,
  PARENT_ID number(38)
);
ALTER TABLE OBJECT_TYPES ADD CONSTRAINT Key2 PRIMARY KEY (OBJECT_TYPE_ID);

-- Table PARAMS

CREATE TABLE PARAMS(
  PARAM_ID number(38) NOT NULL,
  OBJECT_ID number(38) NOT NULL,
  ATTRIBUTE_ID number(38) NOT NULL,
  INTEGER_VALUE Integer,
  DECIMAL_VALUE Float,
  STRING_VALUE Varchar2(10000),
  XML_VALUE Varchar2(10000),
  DATE_VALUE Date,
  LIST_VALUE number(38),
  OBJECT_VALUE number(38),
  PARAMETER_VALUE number(38),
  DATA_VALUE Varchar2(300)
);
ALTER TABLE PARAMS ADD CONSTRAINT Key3 PRIMARY KEY (PARAM_ID);

-- Table ATTRIBUTES

CREATE TABLE ATTRIBUTES(
  ATTRIBUTE_ID number(38) NOT NULL,
  NAME Varchar2(40) NOT NULL,
  TYPE_NAME Varchar2(40) NOT NULL
);
ALTER TABLE ATTRIBUTES ADD CONSTRAINT Key4 PRIMARY KEY (ATTRIBUTE_ID);

-- Table ATTRIBUTE_TYPES

CREATE TABLE ATTRIBUTE_TYPES(
  TYPE_NAME Varchar2(40) NOT NULL
);
ALTER TABLE ATTRIBUTE_TYPES ADD CONSTRAINT Key5 PRIMARY KEY (TYPE_NAME);

-- Table LIST_TYPE

CREATE TABLE LIST_TYPE(
  LIST_ID number(38) NOT NULL,
  VALUE Varchar2(1000),
  ATTRIBUTE_ID number(38)
);
ALTER TABLE LIST_TYPE ADD CONSTRAINT Key6 PRIMARY KEY (LIST_ID);

-- Table OBJECT_TYPE_ATTRIBUTES

CREATE TABLE OBJECT_TYPE_ATTRIBUTES(
  OBJECT_TYPE_ID number(38) NOT NULL,
  ATTRIBUTE_ID number(38) NOT NULL
);
ALTER TABLE OBJECT_TYPE_ATTRIBUTES ADD CONSTRAINT Key7 PRIMARY KEY (OBJECT_TYPE_ID,ATTRIBUTE_ID);

-- Create relationships section -------------------------------------------------

ALTER TABLE OBJECTS ADD CONSTRAINT FKey1 FOREIGN KEY (OBJECT_TYPE_ID) REFERENCES OBJECT_TYPES (OBJECT_TYPE_ID);

ALTER TABLE PARAMS ADD CONSTRAINT FKey2 FOREIGN KEY (ATTRIBUTE_ID) REFERENCES ATTRIBUTES (ATTRIBUTE_ID);

ALTER TABLE ATTRIBUTES ADD CONSTRAINT FKey3 FOREIGN KEY (TYPE_NAME) REFERENCES ATTRIBUTE_TYPES (TYPE_NAME);

ALTER TABLE OBJECT_TYPES ADD CONSTRAINT FKey4 FOREIGN KEY (PARENT_ID) REFERENCES OBJECT_TYPES (OBJECT_TYPE_ID);

ALTER TABLE OBJECTS ADD CONSTRAINT FKey5 FOREIGN KEY (PARENT_ID) REFERENCES OBJECTS (OBJECT_ID);

ALTER TABLE OBJECT_TYPE_ATTRIBUTES ADD CONSTRAINT FKey6 FOREIGN KEY (OBJECT_TYPE_ID) REFERENCES OBJECT_TYPES (OBJECT_TYPE_ID);

ALTER TABLE OBJECT_TYPE_ATTRIBUTES ADD CONSTRAINT FKey7 FOREIGN KEY (ATTRIBUTE_ID) REFERENCES ATTRIBUTES (ATTRIBUTE_ID);

ALTER TABLE PARAMS ADD CONSTRAINT FKey8 FOREIGN KEY (OBJECT_ID) REFERENCES OBJECTS (OBJECT_ID);

ALTER TABLE PARAMS ADD CONSTRAINT FKey9 FOREIGN KEY (LIST_VALUE) REFERENCES LIST_TYPE (LIST_ID);

ALTER TABLE PARAMS ADD CONSTRAINT FKey10 FOREIGN KEY (PARAMETER_VALUE) REFERENCES PARAMS (param_ID);

ALTER TABLE LIST_TYPE ADD CONSTRAINT FKey11 FOREIGN KEY (ATTRIBUTE_ID) REFERENCES ATTRIBUTES (ATTRIBUTE_ID);

ALTER TABLE PARAMS ADD CONSTRAINT FKey12 FOREIGN KEY (OBJECT_VALUE) REFERENCES OBJECTS (OBJECT_ID);

